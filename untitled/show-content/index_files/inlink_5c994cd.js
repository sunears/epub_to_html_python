define("wiki-mobile-common:widget/component/inlink/inlink.js",function(i,n,e){function t(){l(".body-wrapper a").live("click",s),(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&(h=1),window.addEventListener("orientationchange",function(){l("#chain").hide()},!1),l("#chain .chain-mask").on("touchstart",function(i){i.preventDefault(),l("#chain").hide()}),l("#J-chain-close").live("tap",function(){l("#chain").hide()}).live("touchstart",function(i){i.preventDefault()}),l(window).on("scroll",function(){if("block"===l("#chain").css("display")){var i=parseInt(l("#chain").css("top"),10)+parseInt(l("#chain .chain-con").css("top"),10)-44,n=parseInt(l("#chain").css("top"),10)-parseInt(l("#chain .chain-con").css("top"),10),e=document.documentElement.clientHeight;1===h&&(e=90===window.orientation||-90===window.orientation?window.screen.width:window.screen.height),(l(window).scrollTop()>i||l(window).scrollTop()<n)&&l("#chain").hide()}})}function a(i,n){"undefined"==typeof i&&(i=l(this));var e=i.text(),t="";if(i.attr("href").search(/subview\/|view\/|item\//)&&(t=i.attr("href"),""!==t)){n.preventDefault(),t=t+(t.indexOf("?")>0?"&":"?")+"bk_fr=chain";var a='<div class="content"><a class="J-inlink J-inlink-title" data-href="';a+=t+'_title" href="javascript:;">',a+='<span class="title">'+e+"</span></a>",a+='<div class="chain-close" id="J-chain-close">',a+='<em class="layout-icons layout-icons_close"></em></div></div>',a+='<a class="link J-inlink J-inlink-bottom" data-href="'+t+'_bottom" href="javascript:;">查看词条</a>',a+='<div class="loading">正在加载</div>',l("#chain .chain-con").html(a),e.indexOf("/")>-1&&(e=e.split("/")[0]),o(e,t,n,i.attr("data-newlemmaid")),r.q(l("#chain").data("inlink-click")?l("#chain").data("inlink-click"):"inlinkClick")}}function c(i){var n=i.target.getBoundingClientRect(),e=n.left,t=n.top,a=document.documentElement.clientWidth,c=document.documentElement.clientHeight;if(1===h&&(a=window.screen.width,c=window.screen.height),l("#chain").css({top:document.body.scrollTop+"px",height:c+"px",display:"block"}),90===window.orientation||-90===window.orientation)l("#chain .chain-con").css(1===h?{left:.2*c,top:"47px",width:.6*c+"px"}:{left:.2*a,top:"47px",width:.6*a+"px"}),l("#chain .chain-arrow").css("display","none");else{if(1===h)var o=c/2-20;else var o=c/2;t>=o?(l("#chain .chain-con").css({left:"10px",top:t-240+"px",width:a-20+"px"}),l("#chain .chain-arrow").css({left:e+10+"px","-webkit-transform":"rotate(225deg)",top:t-29+"px",display:"block",background:"#fafafa"})):(l("#chain .chain-con").css({left:"10px",top:t+35+"px",width:a-20+"px"}),l("#chain .chain-arrow").css({left:e+10+"px",top:t+25+"px","-webkit-transform":"rotate(45deg)",display:"block",background:"#ffffff"}))}}function o(i,n,e,t){var a=new RegExp("/subview/(.*?)/(.*?).htm"),o=new RegExp("/view/(.*?).htm"),s="/wap/summary?title="+i;if(n.indexOf("subview")>0){var r=a.exec(n);r[1]&&r[2]&&(s="/wap/summary?lemmaid="+r[1]+"&sublemmaid="+r[2])}else if(n.indexOf("view")>0){var r=o.exec(n);r[1]&&(s="/wap/summary?lemmaid="+r[1])}else n.indexOf("item")>0&&(s=t?"/wap/summary?title="+i+"&newlemmaid="+t:"/wap/summary?title="+i);l.getJSON(s,function(i){if(null!=i){l("#chain .loading").hide();var e="";i.imgSrc&&""!==i.imgSrc&&(e='<a class="con-img J-inlink J-inlink-img" data-href="',e+=n+'_img"  href="javascript:;">',e+='<img src="'+i.imgUrl+'" /></a>'),e+='<a class="J-inlink J-inlink-summary" data-href="',e+=n+'_summary"  href="javascript:;">',e+='<div class="txt">'+i.summaryContent.replace(/<[^>]+>/g,"")+"</div></a>",l("#chain .chain-con .content").append(e)}}),c(e)}function s(i){var n=l(this),e=n.attr("href");if(!n.hasClass("no-inlink")){if(!(e.search(/\/subview\/|\/view\/|\/item\//)>-1))return;i.preventDefault(),a(n,i)}}var l=i("wiki-mobile-common:widget/lib/zepto/zepto.js"),r=i("wiki-mobile-common:widget/util/nslog.js"),h=0;e.exports=t});